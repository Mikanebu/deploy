proxy:
  image: 'dockercloud/haproxy:latest'
  links:
    - auth
    - rawstore
    - frontend
  ports:
    - '80:80'
    - '443:80'
  roles:
    - global
frontend:
  image: datopian/datahub-frontend:latest
  ports:
    - "4000:4000"
  environment:
    VIRTUAL_HOST: ${DOMAIN},https://${DOMAIN}
auth:
  image: datopian/auth
  links:
    - postgres
  ports:
    - "8000:8000"
  target_num_containers: 1
  environment:
    VIRTUAL_HOST: ${DOMAIN_API}/auth/*,${DOMAIN_API}:443/auth/*
    GUNICORN_PORT: 8000
    DATABASE_URL: "postgresql://auth_service@postgres/auth_service"
    EXTERNAL_ADDRESS: api.${DOMAIN}
    PRIVATE_KEY:
    PUBLIC_KEY:
    GOOGLE_KEY:
    GOOGLE_SECRET:
    GITHUB_KEY:
    GITHUB_SECRET:
postgres:
  image: postgres
  target_num_containers: 1
  ports:
    - "5432:5432"
  environment:
    POSTGRES_USER: "auth_service"
    POSTGRES_DB: "auth_service"
rawstore:
  image: 'datopian/bitstore:latest'
  ports:
    - '8001:8001'
  target_num_containers: 1
  environment:
    VIRTUAL_HOST: ${DOMAIN_API}/rawstore/*,${DOMAIN_API}:443/rawstore/*
    GUNICORN_PORT: 8001
